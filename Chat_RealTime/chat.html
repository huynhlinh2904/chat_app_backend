<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!--[if IE]>
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]-->
    <title>GK-ERP Hệ thống quản trị doanh nghiệp toàn diện </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Favicons -->

    <link rel="apple-touch-icon-precomposed" sizes="144x144"
        href="../../../assets/images/icons/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
        href="../../../assets/images/icons/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
        href="../../../assets/images/icons/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../../../assets/images/icons/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="../../../assets/images/icons/favicon.png">

    <link rel="stylesheet" href="../../common/css/Common.css">
    <link rel="stylesheet" href="../../../assets/widgets/jstree/style.min.css" />
    <link rel="stylesheet" href="../../../assets/widgets/summernote-wysiwyg/summernote-wysiwyg.css" />
    <link rel="stylesheet" href="chat.css" />
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.7.1/css/lightgallery-bundle.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/emoji-mart@5.4.0/dist-modern/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.1/lightgallery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script>
    <!-- JS Core -->
    <script type="text/javascript" src="../../../assets/js-core/jquery-core.js"></script>
    <script type="text/javascript" src="../../../assets/js-core/jquery-ui-core.js"></script>
    <script type="text/javascript" src="../../../assets/widgets/summernote-wysiwyg/summernote-wysiwyg.js"></script>
    <script type="text/javascript" src="../../common/js/Common.js"></script>
    <script type="text/javascript" src="../../common/js/util_element.js"></script>
    <script type="text/javascript" src="../../common/js/util.js"></script>
    <!--Signal-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.11/signalr.min.js"></script>



    <script src="simple-tree-table/dist/jquery-simple-tree-table.js"></script>

    <!-- calender -->
    <script type="text/javascript" src="../../../assets/widgets/daterangepicker/moment.js"></script>
    <script type="text/javascript" src="../../../assets/widgets/calendar/calendar.js"></script>
    <script type="text/javascript" src="../../../assets/widgets/slimscroll/slimscroll.js"></script>

    <!-- select2.js -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="./js/signalR.js"></script>


</head>

<body>
    <div id="sb-site">
        <!-- SLIDER BAR LEFT -->
        <div class="sb-slidebar bg-black sb-left sb-style-overlay">
        </div>
        <!-- SLIDER BAR RIGHT -->
        <div class="sb-slidebar bg-black sb-right sb-style-overlay">
        </div>
        <div id="loading">
            <div class="spinner">
                <div class="bounce1"></div>
                <div class="bounce2"></div>
                <div class="bounce3"></div>
            </div>
        </div>
        <div id="loadingcustom">
            <div class="loading-spinner">
                <i class="bg-blue"></i>
                <i class="bg-blue"></i>
                <i class="bg-blue"></i>
                <i class="bg-blue"></i>
                <i class="bg-blue"></i>
                <i class="bg-blue"></i>
            </div>
            <div id="loading-text" class="loading-text">Loading...</div>
        </div>
        <div id="page-wrapper">
            <!-- TOPBAR -->
            <div id="page-header" class="bg-gradient-9">
            </div>
            <!-- SLIDER BAR-->
            <div id="page-sidebar">
            </div>
            <!-- PAGE CONTENT-->
            <div id="page-content-wrapper">
                <div id="page-content">
                    <div class="container">
                        <!--Lấy danh sách nhân viên-->
                        <div class="cv-wrapper main-CV" id="cv-container">
                            <div id="leftPane" class="cv-panel pane">
                                <h2 style="margin-bottom: 20px;">Đoạn chat</h2>
                                <div class="searchBar">
                                    <div class="searchBar-search">
                                        <input type="text" class="searchBar-input" id="custom-filter"
                                            placeholder="Tìm kiếm">
                                        <button class="bg-primary r-5 l-5 t-5" type="button" id="btnAddStaff"
                                            onclick="modal_Main.openModal('createGroupModal');">
                                            <span>Thêm</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="tab-header">
                                    <button class="tab-btn active" data-tab="employees-tab">Nhân viên</button>
                                    <button class="tab-btn" data-tab="groups-tab">Nhóm</button>
                                </div>
                                <div id="tab-content">
                                    <div id="employees-tab" class="tab-pane active">
                                        <div id="employee-container">
                                            <div id="employee-list" class="employee-list"></div>
                                        </div>
                                    </div>
                                    <div id="groups-tab" class="tab-pane">
                                        <div id="resultGroup" class="resultGroup" style="margin-top: 10px;"></div>
                                    </div>
                                </div>
                            </div>
                            <!--Đoạn chat bên trái-->
                            <div id="rightPane" class="cv-panel pane"
                                style=" height: 100%; display: flex; flex-direction: column; margin-top: 30px; padding: 20px; transition: all 0.3s ease;">
                                <div class="content-box" style="flex: 1; display: flex; flex-direction: column;">
                                    <h3 class="content-box-header bg-blue text-left" style="margin: 0;">
                                        <div class="chat-author"
                                            style="display: flex; align-items: center; justify-content: space-between;">

                                            <!-- Bên trái: avatar + tên -->
                                            <div style="display: flex; align-items: center;">
                                                <img id="chat-user-avatar" width="36"
                                                    src="../../../assets/image-resources/gravatar.jpg" alt=""
                                                    style="margin-right: 10px;">
                                                <h1 id="chat-user-name" class="white-color"
                                                    style="font-size: 16px; margin: 0;">TÊN NGƯỜI NHẬN TIN NHẮN</h1>
                                               <button id="btn-update-group" style="margin-left: 20px; height: 50px; width: 50px; color: #88f;" onclick="modal_Main.updateGroup()">
                                                <i class="fa-regular fa-pen-fancy"></i>
                                               </button>
                                            </button>

                                            </div>

                                            <!-- Bên phải: nút dấu + -->
                                            <!-- <button id="btn-add-user" class="btn bg-primary"
                                                style="margin-right: 10px; color: #fff; display: none;"
                                                onclick="modal_Main.openModal('addGroupModal')">
                                                <i class="glyph-icon icon-plus"></i>
                                            </button> -->
                                            <!-- Nút toggle user info panel -->
                                            <button id="toggle-user-info-btn" class="btn bg-light"
                                                style="position: absolute; top: 20px; right: 20px; z-index: 1000;"
                                                onclick="toggleUserInfoPanel()">
                                                <i class="fa-solid fa-info"></i>
                                            </button>

                                        </div>
                                    </h3>

                                    <div class="content-box-wrapper"
                                        style="flex: 1; flex-direction: column; overflow: hidden;">
                                        <!-- Chat content scroll -->
                                        <div class="scrollable-content" style="flex: 1;">
                                            <ul class="chat-box">
                                                <li class="chat-message incoming">

                                                </li>
                                                <!-- Nội dung tin nhắn -->
                                            </ul>
                                            <div id="chat-loading"
                                                style="text-align: center; padding: 10px; display: none;">
                                                <span>⏳ Đang tải tin nhắn...</span>
                                            </div>
                                        </div>
                                        <!-- Nút đính kèm file -->
                                        <input type="file" id="chat-attachment" style="display: block; margin-top: 5%; "
                                            multiple />
                                        <!-- Input gửi tin nhắn -->
                                        <div class="button-pane pad10A"
                                            style="border-top: 1px solid #ddd; background: #fff;">
                                            <div class="input-group">
                                                <!--  Box preview trả lời -->
                                                <div id="reply-preview-box"
                                                    style="display: none; width: 100%; background: #eef; padding: 6px 12px; border-left: 4px solid #88f; margin-bottom: 8px; border-radius: 4px; position: relative;">
                                                    <div class="replying-to">
                                                        <!-- Nội dung preview sẽ được JS đẩy vào -->
                                                    </div>
                                                    <span class="cancel-reply" onclick="modal_Main.cancelReply()"
                                                        title="Huỷ trả lời"
                                                        style="position: absolute; right: 10px; top: 6px; cursor: pointer; color: red; font-weight: bold;">×</span>
                                                </div>

                                                <!-- Input tin nhắn -->
                                                <input type="text" placeholder="Nội dung tin nhắn" class="form-control"
                                                    id="chat-input">

                                                <div class="input-group-btn">
                                                    <!-- Nút gửi tin nhắn -->
                                                    <button type="button" class="btn btn-primary"
                                                        onclick="modal_Main.sendMessage()">
                                                        <i class="glyph-icon icon-send"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Cột phải: Thông tin người dùng -->
                            <div id="user-info-panel" class="cv-panel pane">
                                <!-- <h4 class="mb-5" style="text-align: center;">Thông tin người dùng</h4> -->
                                <div id="user-avatar" style="text-align: center;">
                                    <img id="user-avatar-img" src="../../../assets/image-resources/gravatar.jpg"
                                        width="80" class="img-circle" src="./img/anh-avatar-nhom.jpg" />
                                    <p id="user-fullname"><strong>Tên người nhận tin nhắn</strong></p>
                                </div>

                                <hr>

                                <div>
                                    <button class="btn btn-sm btn-primary" onclick="modal_Main.selectFile()">📁 Xem
                                        liên
                                        kết</button>
                                    <button class="btn btn-sm btn-info" onclick="modal_Main.selectImage()">🖼️ Xem
                                        ảnh</button>
                                    <button class="btn btn-sm btn-default" onclick="modal_Main.viewProfile()">👤 Hồ
                                        sơ
                                        cá nhân</button>
                                </div>
                                <div id="group-members" style="margin-top: 20px;">
                                    <button onclick="modal_Main.getListUserByConversation()" id="member-title">
                                        <strong>Thành viên nhóm</strong>
                                    </button>
                                    <ul id="member-list">

                                    </ul>
                                </div>

                                <!-- Khung hiển thị dữ liệu động -->
                                <div id="file-image-display-wrapper"
                                    style="max-height: 600px; overflow-y: auto; padding: 20px;">
                                    <div id="file-image-display" style="margin-top: 30px;"></div>
                                </div>

                            </div>
                        </div>
                        <!-- Tab chuyển layout -->
                        <div id="mobile-nav" class="mobile-nav">
                            <button onclick="showPane('leftPane')">📋 Danh sách</button>
                            <button onclick="showPane('rightPane')">💬 Chat</button>
                            <button onclick="showPane('user-info-panel')">👤 Thông tin</button>
                        </div>

                        <!--END MAIN PAGE-->
                        <!--Modal create group-->
                        <div id="createGroupModal" class="modal">
                            <div class="modal-content">
                                <span class="close-btn"
                                    onclick="modal_Main.closeModal('createGroupModal')">&times;</span>
                                <h2>Tạo nhóm</h2>

                                <input id="groupName" type="text" placeholder="Nhập tên nhóm..." />
                                <input id="searchUser" type="text" placeholder="Tìm kiếm tên nhân viên"
                                    oninput="modal_Main.filterUsers('createGroupModal')" />

                                <div id="userList" class="user-list">
                                    <!-- Users will be rendered here -->
                                </div>
                                <!-- Chọn ảnh đại diện -->
                                <div class="form-group" style="margin-top: 5%;">
                                    <label for="groupImage">Ảnh nhóm (tuỳ chọn)</label>
                                    <input id="groupImage" type="file" accept="image/*"
                                        onchange="modal_Main.previewImage()" />

                                    <!-- Khung hiển thị ảnh -->
                                    <div id="imagePreviewWrapper" class="image-preview-wrapper">
                                        <img id="imagePreview" class="image-preview" src="#" alt="Ảnh xem trước"
                                            style="display: none;" />
                                    </div>
                                </div>

                                <div class="footer">
                                    <button onclick="modal_Main.closeModal('createGroupModal')">Hủy</button>
                                    <button id="createGroupBtn" onclick="modal_Main.createGroup()">Tạo nhóm</button>
                                </div>
                            </div>
                        </div>
                        <!--Modal add user to group-->
                        <div id="addGroupModal" class="modal">
                            <div class="modal-content">
                                <span class="close-btn" onclick="modal_Main.closeModal('addGroupModal')">&times;</span>
                                <h2>Thêm nhân viên vào nhóm</h2>
                                <input id="searchUser-add" type="text" placeholder="🔍 Tìm kiếm nhân viên"
                                    oninput="modal_Main.filterUsers('addGroupModal')" />

                                <div id="userList-add" class="user-list">
                                    <!-- Users will be rendered here -->
                                </div>

                                <div class="footer">
                                    <button onclick="modal_Main.closeModal('addGroupModal')">Hủy</button>
                                    <button id="addGroupBtn" onclick="modal_Main.addUserToGroup()">Thêm nhân
                                        viên</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="close-gallery">❌ Đóng ảnh</button>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="chat.js" defer></script>
</body>

</html>